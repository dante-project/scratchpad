<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>KaTOS &#8212; KaTOS 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="KaTOS 0.1 documentation" href="#" />
    <link rel="next" title="Notes" href="notes.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="katos">
<h1>KaTOS<a class="headerlink" href="#katos" title="Permalink to this headline">¶</a></h1>
<p>KaTOS is simple OS written in modern C++.</p>
<p>Every single step from building cross compiler to documentation is automated, only prerequisites are virtualbox and vagrant.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">dante</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">scratchpad</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">scratchpad</span> <span class="o">&amp;&amp;</span> <span class="n">vagrant</span> <span class="n">up</span>
</pre></div>
</div>
<p>The bootstrap.sh script will get executed on machines boot and install all the tools you need to compile the OS.
It will also run makefiles and output OS image in /home/build.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To log into virtual machine run <cite>vagrant ssh</cite>, to exit the VM run <cite>logout</cite>, to shutdown the machine run <cite>vagrant halt</cite>, and finally to terminate use of resources on your machine (including virtual machines disks) run <cite>vagrant destroy</cite>.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Developing OS is complex task that requires very specific development environment and
set of tools. Theoretically one could write an OS in any language he wants, however assembly,
C and C++ are de facto languages for this kind of job.</p>
<p>Our compiler suite of choice is GCC, build system cmake, and scripting language Bash.
Everything is build and assembled inside virtual machine built by vagrant. Vagrant
enables us to automate complete complex process of building cross compiler, OS, linking
and producing iso (even building documentation) into a single <code class="docutils literal"><span class="pre">vagrant</span> <span class="pre">up</span></code> command.</p>
<p>All development and examples were ran on Debian 9. Feel free to work from vagrant machine
if you don&#8217;t want to bother with setting up everything on your own host OS.</p>
</div>
<div class="section" id="development-environment">
<h2>Development environment<a class="headerlink" href="#development-environment" title="Permalink to this headline">¶</a></h2>
<p>Since we will be building and installing a lot of tools frequently many things could go wrong.
To make our life easier we can use virtual machines, and to make everything even more hassle free,
we can utilize virtual machine manager, such as vagrant.</p>
<div class="section" id="preparing-the-box">
<h3>Preparing the box<a class="headerlink" href="#preparing-the-box" title="Permalink to this headline">¶</a></h3>
<p>Installing virtualbox and vagrant on Debian 9 is rather straightforward:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="c1"># add stretch-backports main and contrib to your apt sources</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">virtualbox</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">releases</span><span class="o">.</span><span class="n">hashicorp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">vagrant_2</span><span class="o">.</span><span class="mf">1.1</span><span class="n">_x86_64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">vagrant_2</span><span class="o">.</span><span class="mf">1.1</span><span class="n">_x86_64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
<p>Once we have the software we can write small vagrant script:</p>
<div class="code ruby highlight-default"><div class="highlight"><pre><span></span><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>
<span class="n">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="n">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;generic/debian9&quot;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_check_update</span> <span class="o">=</span> <span class="n">false</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;/home/src&quot;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="p">:</span><span class="n">shell</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="s2">&quot;bootstrap.sh&quot;</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Save it as Vagrantfile in the root of the project. This particular vagrant file downloads
Debian 9 image, mounts its root directory under <code class="docutils literal"><span class="pre">/home/src</span></code> in the virtual machine and
executes <code class="docutils literal"><span class="pre">bootstrap.sh</span></code>. Shell script then invokes <code class="docutils literal"><span class="pre">i686-elf-tools.sh</span></code> script that
downloads necessary sources and compiles cross compiler. Once the compiler is built
bootstrap script invokes cmake that builds the OS itself, bootable iso and
documentation.</p>
<p>Finally, starting whole building process is as simple as executing <code class="docutils literal"><span class="pre">vargant</span> <span class="pre">up</span></code> in the
projects root directory.</p>
</div>
<div class="section" id="cross-compiler">
<h3>Cross Compiler<a class="headerlink" href="#cross-compiler" title="Permalink to this headline">¶</a></h3>
<p>An cross-compiler is a compiler that runs on platform A (the host), but generates executables for platform B (the target).
These two platforms may (but do not need to) differ in CPU, operating system, and/or executable format. In our case,
the host platform is our current operating system, and the target platform is the operating system we are building.</p>
<img alt="_images/cross-compiler.png" src="_images/cross-compiler.png" />
<p>GCC is great open source compiler and we will use it as cross compiler for our OS. The GNU Compiler Collection is an advanced piece of software with many dependencies. We will also need Binutils which are collection of binary tools, since we are also interested in linker and assembler.</p>
<p>Cross compiler building process is rather complex and lengthy process. See i686-elf-tools.sh for details.</p>
</div>
<div class="section" id="first-steps">
<h3>First steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h3>
<p>Small assembly code to demonstrate building bootable iso image.</p>
<div class="highlight-nasm"><div class="highlight"><pre><span></span><span class="k">global</span> <span class="nv">loader</span>                   <span class="c1">; the entry symbol for ELF</span>

<span class="no">MAGIC_NUMBER</span><span class="kd"> equ</span> <span class="mh">0x1BADB002</span>     <span class="c1">; define the magic number constant</span>
<span class="no">FLAGS</span><span class="kd">        equ</span> <span class="mh">0x0</span>            <span class="c1">; multiboot flags</span>
<span class="no">CHECKSUM</span><span class="kd">     equ</span> <span class="o">-</span><span class="nv">MAGIC_NUMBER</span>  <span class="c1">; calculate the checksum</span>
                                <span class="c1">; (magic number + checksum + flags should equal 0)</span>

<span class="k">section</span> <span class="nv">.text</span><span class="p">:</span>                  <span class="c1">; start of the text (code) section</span>
<span class="k">align</span> <span class="mi">4</span>                         <span class="c1">; the code must be 4 byte aligned</span>
    <span class="kd">dd</span> <span class="nv">MAGIC_NUMBER</span>             <span class="c1">; write the magic number to the machine code,</span>
    <span class="kd">dd</span> <span class="nv">FLAGS</span>                    <span class="c1">; the flags,</span>
    <span class="kd">dd</span> <span class="nb">CH</span><span class="nv">ECKSUM</span>                 <span class="c1">; and the checksum</span>

<span class="nl">loader:</span>                         <span class="c1">; the loader label (defined as entry point in linker script)</span>
    <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mh">0xCAFEBABE</span>         <span class="c1">; place the number 0xCAFEBABE in the register eax</span>
<span class="nl">.loop:</span>
    <span class="nf">jmp</span> <span class="nv">.loop</span>                   <span class="c1">; loop forever</span>
</pre></div>
</div>
<p>The file loader.s can be compiled into a 32 bits ELF [18] object file with the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nasm -f elf32 loader.s
</pre></div>
</div>
<p>The code must now be linked to produce an executable file, which requires some extra thought
compared to when linking most programs. We want GRUB to load the kernel at a memory address
larger than or equal to 0x00100000 (1 megabyte (MB)), because addresses lower than 1 MB are
used by GRUB itself, BIOS and memory-mapped I/O. Therefore, the following linker script is
needed (written for GNU LD):</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">ENTRY</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>                <span class="o">/*</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">entry</span> <span class="n">label</span> <span class="o">*/</span>

<span class="n">SECTIONS</span> <span class="p">{</span>
    <span class="o">.</span> <span class="o">=</span> <span class="mh">0x00100000</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">the</span> <span class="n">code</span> <span class="n">should</span> <span class="n">be</span> <span class="n">loaded</span> <span class="n">at</span> <span class="mi">1</span> <span class="n">MB</span> <span class="o">*/</span>

    <span class="o">.</span><span class="n">text</span> <span class="n">ALIGN</span> <span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span> <span class="p">:</span>   <span class="o">/*</span> <span class="n">align</span> <span class="n">at</span> <span class="mi">4</span> <span class="n">KB</span> <span class="o">*/</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>             <span class="o">/*</span> <span class="nb">all</span> <span class="n">text</span> <span class="n">sections</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">files</span> <span class="o">*/</span>
    <span class="p">}</span>

    <span class="o">.</span><span class="n">rodata</span> <span class="n">ALIGN</span> <span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span> <span class="p">:</span> <span class="o">/*</span> <span class="n">align</span> <span class="n">at</span> <span class="mi">4</span> <span class="n">KB</span> <span class="o">*/</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">.</span><span class="n">rodata</span><span class="o">*</span><span class="p">)</span>          <span class="o">/*</span> <span class="nb">all</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span> <span class="n">data</span> <span class="n">sections</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">files</span> <span class="o">*/</span>
    <span class="p">}</span>

    <span class="o">.</span><span class="n">data</span> <span class="n">ALIGN</span> <span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span> <span class="p">:</span>   <span class="o">/*</span> <span class="n">align</span> <span class="n">at</span> <span class="mi">4</span> <span class="n">KB</span> <span class="o">*/</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>             <span class="o">/*</span> <span class="nb">all</span> <span class="n">data</span> <span class="n">sections</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">files</span> <span class="o">*/</span>
    <span class="p">}</span>

    <span class="o">.</span><span class="n">bss</span> <span class="n">ALIGN</span> <span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span> <span class="p">:</span>    <span class="o">/*</span> <span class="n">align</span> <span class="n">at</span> <span class="mi">4</span> <span class="n">KB</span> <span class="o">*/</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="n">COMMON</span><span class="p">)</span>            <span class="o">/*</span> <span class="nb">all</span> <span class="n">COMMON</span> <span class="n">sections</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">files</span> <span class="o">*/</span>
        <span class="o">*</span><span class="p">(</span><span class="o">.</span><span class="n">bss</span><span class="p">)</span>              <span class="o">/*</span> <span class="nb">all</span> <span class="n">bss</span> <span class="n">sections</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">files</span> <span class="o">*/</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Save the linker script into a file called link.ld. The executable can now be linked with
the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ld -T link.ld -melf_i386 loader.o -o kernel.elf
</pre></div>
</div>
<p>If you have GRUB installed, you can check whether a file has a valid Multiboot version 1 header,
which is the case for our kernel. It&#8217;s important that the Multiboot header is within the first
8 KiB of the actual program file at 4 byte alignment. This can potentially break later if you
make a mistake in the boot assembly, the linker script, or anything else that might go wrong.
If the header isn&#8217;t valid, GRUB will give an error that it can&#8217;t find a Multiboot header when
you try to boot it. This code fragment will help you diagnose such cases:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">grub</span><span class="o">-</span><span class="n">file</span> <span class="o">--</span><span class="ow">is</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="n">multiboot</span> <span class="n">kernel</span><span class="o">.</span><span class="n">elf</span>
</pre></div>
</div>
<p>Grub-file is quiet but will exit 0 (successfully) if it is a valid multiboot kernel and exit 1
(unsuccessfully) otherwise. You can type <code class="docutils literal"><span class="pre">echo</span> <span class="pre">$?</span></code> in your shell immediately afterwards to see
the exit status.</p>
</div>
<div class="section" id="building-iso">
<h3>Building ISO<a class="headerlink" href="#building-iso" title="Permalink to this headline">¶</a></h3>
<p>We will create the kernel ISO image with the program genisoimage. A folder must first be created that contains the files that will be on the ISO image. The following commands create the folder and copy the files to their correct places:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">iso</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">grub</span>              <span class="c1"># create the folder structure</span>
<span class="n">cp</span> <span class="n">stage2_eltorito</span> <span class="n">iso</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">grub</span><span class="o">/</span>   <span class="c1"># copy the bootloader</span>
<span class="n">cp</span> <span class="n">kernel</span><span class="o">.</span><span class="n">elf</span> <span class="n">iso</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span>             <span class="c1"># copy the kernel</span>
</pre></div>
</div>
<p>A <a class="reference external" href="https://www.gnu.org/software/grub/manual/legacy/Configuration.html#Configuration">configuration file</a> menu.lst for GRUB must be created. This file tells GRUB where the kernel is located and configures some options:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">=</span><span class="mi">0</span>
<span class="n">timeout</span><span class="o">=</span><span class="mi">0</span>

<span class="n">title</span> <span class="n">os</span>
<span class="n">kernel</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">kernel</span><span class="o">.</span><span class="n">elf</span>
</pre></div>
</div>
<p>Place the file menu.lst in the folder iso/boot/grub/. The contents of the iso folder should now look like the following figure:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">iso</span>
<span class="o">|--</span> <span class="n">boot</span>
  <span class="o">|--</span> <span class="n">grub</span>
  <span class="o">|</span> <span class="o">|--</span> <span class="n">menu</span><span class="o">.</span><span class="n">lst</span>
  <span class="o">|</span> <span class="o">|--</span> <span class="n">stage2_eltorito</span>
  <span class="o">|--</span> <span class="n">kernel</span><span class="o">.</span><span class="n">elf</span>
</pre></div>
</div>
<p>Finally, make a ISO9660 image file like this:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">genisoimage</span> <span class="o">-</span><span class="n">R</span>                              \
            <span class="o">-</span><span class="n">b</span> <span class="n">boot</span><span class="o">/</span><span class="n">grub</span><span class="o">/</span><span class="n">stage2_eltorito</span>    \
            <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">emul</span><span class="o">-</span><span class="n">boot</span>                   \
            <span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">load</span><span class="o">-</span><span class="n">size</span> <span class="mi">4</span>               \
            <span class="o">-</span><span class="n">A</span> <span class="n">os</span>                           \
            <span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="n">charset</span> <span class="n">utf8</span>             \
            <span class="o">-</span><span class="n">quiet</span>                          \
            <span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">info</span><span class="o">-</span><span class="n">table</span>                \
            <span class="o">-</span><span class="n">o</span> <span class="n">os</span><span class="o">.</span><span class="n">iso</span>                       \
            <span class="n">iso</span>
</pre></div>
</div>
<p>For more information about the flags used in the command, see the manual for genisoimage.
This produces a file named os.iso, which then can be burned into a CD (or a DVD) or loaded directly into virtual machine.
The ISO image contains the kernel executable, the GRUB bootloader and the configuration file.</p>
<p>To run the OS in QEMU emulator execute:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">qemu</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">i386</span> <span class="o">-</span><span class="n">cdrom</span> <span class="n">os</span><span class="o">.</span><span class="n">iso</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>x86 is a family of backward-compatible instruction set architectures based on the Intel 8086 CPU and its Intel 8088 variant. The 8086 was introduced in 1978 as a fully 16-bit extension of Intel&#8217;s 8-bit-based 8080 microprocessor, with memory segmentation as a solution for addressing more memory than can be covered by a plain 16-bit address. The term &#8220;x86&#8221; came into being because the names of several successors to Intel&#8217;s 8086 processor end in &#8220;86&#8221;, including the 80186, 80286, 80386 and 80486 processors. [1]</p>
<div class="section" id="bootloader">
<h3>Bootloader<a class="headerlink" href="#bootloader" title="Permalink to this headline">¶</a></h3>
<p>tratra</p>
</div>
<div class="section" id="foobar">
<h3>FooBar<a class="headerlink" href="#foobar" title="Permalink to this headline">¶</a></h3>
<p>tratra</p>
</div>
<div class="section" id="spam">
<h3>Spam<a class="headerlink" href="#spam" title="Permalink to this headline">¶</a></h3>
<p>tratra</p>
</div>
<div class="section" id="spaz">
<h3>Spaz<a class="headerlink" href="#spaz" title="Permalink to this headline">¶</a></h3>
<p>tratra</p>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/X86">https://en.wikipedia.org/wiki/X86</a></li>
<li><a class="reference external" href="https://www.gnu.org/software/grub/manual/legacy">https://www.gnu.org/software/grub/manual/legacy</a></li>
<li><a class="reference external" href="https://littleosbook.github.io">https://littleosbook.github.io</a></li>
<li><a class="reference external" href="https://wiki.osdev.org">https://wiki.osdev.org</a></li>
</ol>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="text">
<h3>Text<a class="headerlink" href="#text" title="Permalink to this headline">¶</a></h3>
<p>Starting address of memory-mapped I/O for the framebuffer is 0x000B8000. Highest 8 bits are ASCII value of the character, bits 7-4 the background and bits 3-0 foreground color.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Bit</span><span class="p">:</span>     <span class="o">|</span><span class="mi">15</span> <span class="mi">14</span> <span class="mi">13</span> <span class="mi">12</span> <span class="mi">11</span> <span class="mi">10</span> <span class="mi">9</span> <span class="mi">8</span><span class="o">|</span><span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span><span class="o">|</span><span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span><span class="o">|</span>
<span class="n">Content</span><span class="p">:</span> <span class="o">|</span> <span class="n">ASCII</span>               <span class="o">|</span> <span class="n">FG</span>    <span class="o">|</span> <span class="n">BG</span>    <span class="o">|</span>
</pre></div>
</div>
<p>Say you want to write &#8216;A&#8217;(65,or 0x41) with green foreground and dark grey background(8) at place (0,0) you would write assembly code
<code class="docutils literal"><span class="pre">mov</span> <span class="pre">[0x000B8000],</span> <span class="pre">0x4128</span></code>
where 0x41 represents ASCII A, 2 is green and 8 is dark grey color.</p>
<p>Second cell (0,1) is 0x000B8000 + 16 = 0x000B8010</p>
<p>Colors: <a class="reference external" href="https://i.imgur.com/bLhytNP.png">https://i.imgur.com/bLhytNP.png</a></p>
</div>
<div class="section" id="x86-assembly">
<h3>x86 Assembly<a class="headerlink" href="#x86-assembly" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Lets</span> <span class="n">make</span> <span class="n">some</span> <span class="n">test</span> <span class="n">files</span>
<span class="o">&gt;</span> <span class="n">nano</span> <span class="n">test</span><span class="o">.</span><span class="n">asm</span>
<span class="o">&gt;</span> <span class="n">nasm</span> <span class="o">-</span><span class="n">f</span> <span class="nb">bin</span> <span class="n">test</span><span class="o">.</span><span class="n">asm</span> <span class="o">-</span><span class="n">o</span> <span class="n">test</span>  <span class="p">(</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">nasm</span><span class="p">)</span>
   <span class="o">-</span><span class="n">f</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">file</span> <span class="nb">format</span> <span class="n">of</span> <span class="n">the</span> <span class="n">output</span> <span class="n">file</span><span class="p">(</span><span class="o">-</span><span class="n">o</span><span class="p">)</span>
   <span class="ow">in</span> <span class="n">this</span> <span class="n">case</span> <span class="n">its</span> <span class="nb">bin</span><span class="p">(</span><span class="n">flat</span> <span class="n">binary</span> <span class="n">output</span> <span class="n">without</span> <span class="nb">any</span> <span class="n">extra</span> <span class="n">information</span><span class="p">,</span>
   <span class="k">as</span> <span class="ow">in</span> <span class="n">assembly</span> <span class="n">code</span> <span class="o">-&gt;</span> <span class="n">machine</span> <span class="n">code</span><span class="p">(</span><span class="k">as</span> <span class="ow">is</span><span class="p">,</span> <span class="n">without</span> <span class="n">overhead</span> <span class="n">of</span> <span class="n">metadata</span><span class="p">)</span>

    <span class="n">Note</span><span class="p">:</span> <span class="n">using</span> <span class="nb">bin</span> <span class="nb">format</span> <span class="n">puts</span> <span class="n">nasm</span> <span class="n">by</span> <span class="n">default</span> <span class="n">into</span> <span class="mi">16</span><span class="o">-</span><span class="n">bit</span> <span class="n">mode</span><span class="p">,</span> <span class="n">to</span> <span class="n">enable</span> <span class="mi">32</span><span class="n">bit</span>
      <span class="n">add</span> <span class="s2">&quot;bits 32&quot;</span> <span class="n">at</span> <span class="n">beginning</span> <span class="n">of</span> <span class="n">an</span> <span class="n">nasm</span> <span class="n">source</span> <span class="n">file</span>

<span class="n">we</span> <span class="n">can</span> <span class="n">examine</span> <span class="n">the</span> <span class="n">output</span> <span class="n">using</span> <span class="n">hd</span><span class="p">(</span><span class="n">HexDump</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">hd</span> <span class="n">test</span>
<span class="mi">00000000</span> <span class="mi">66</span> <span class="n">ff</span> <span class="n">e0</span>            <span class="o">|</span><span class="n">f</span><span class="o">..|</span>
<span class="mi">00000003</span>
<span class="n">We</span> <span class="n">can</span> <span class="n">see</span> <span class="n">that</span> <span class="n">file</span> <span class="n">only</span> <span class="n">consists</span> <span class="n">of</span> <span class="mi">3</span> <span class="nb">bytes</span> <span class="p">:</span> <span class="mi">66</span> <span class="n">ff</span> <span class="n">e0</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">equivalent</span>
<span class="n">to</span> <span class="n">the</span> <span class="n">instruction</span> <span class="n">jmp</span> <span class="n">eax</span>


<span class="n">In</span> <span class="nb">next</span> <span class="n">few</span> <span class="n">examples</span> <span class="n">im</span> <span class="n">using</span> <span class="s1">&#39;a&#39;</span> <span class="k">as</span> <span class="p">(</span><span class="n">labeled</span> <span class="n">memory</span> <span class="n">address</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">register</span><span class="p">)</span>
<span class="n">mov</span> <span class="n">a</span><span class="p">,</span><span class="mh">0x1</span>    <span class="p">;</span><span class="n">Move</span> <span class="nb">hex</span> <span class="s1">&#39;1&#39;</span> <span class="n">to</span> <span class="s1">&#39;a&#39;</span>
<span class="n">mov</span> <span class="n">a</span><span class="p">,[</span><span class="mh">0x1</span><span class="p">]</span>  <span class="p">;</span><span class="n">Move</span> <span class="n">value</span> <span class="n">on</span> <span class="n">location</span> <span class="s1">&#39;0x1&#39;</span> <span class="n">to</span> <span class="s1">&#39;a&#39;</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>calc</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span>add a   ;a=a+0x1 | (a=a+1)
add a,b ;a=a+b

sub a,b ;a=a-b

;To multiply we need to use eax
mov eax,5  ; eax = 5 (eax is acc used by multiplication)
imul eax,2 ; eax = eax*2
;imul Performs singed multiply, we can also use mul to perform unsigned mult.

; Divsion
mov eax, 5       ;eax = 5
cdq              ;?
idiv 2           ;Perform division,store result in &#39;eax&#39; and store reminder in &#39;edx&#39;
mov result,eax   ;result = edx  -&gt; result==2
mov reminder,edx ;reminder=edx -&gt; reminder == 1

So basicly from Division we can get &#39;/&#39; and &#39;%&#39; as result
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Logic</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">;</span> <span class="n">NEG</span>
<span class="n">mov</span> <span class="n">a</span><span class="p">,</span><span class="mi">5</span>
<span class="n">neg</span> <span class="n">a</span> <span class="p">;</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">-</span><span class="n">a</span> <span class="p">,</span> <span class="n">that</span> <span class="n">means</span> <span class="n">a</span><span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="p">,</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">case</span> <span class="n">a</span><span class="o">==-</span><span class="mi">5</span>

<span class="p">;</span> <span class="n">AND</span> <span class="p">(</span><span class="n">performes</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="ow">not</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">)</span>
<span class="p">;</span><span class="n">That</span> <span class="n">means</span> <span class="k">if</span> <span class="n">we</span> <span class="n">have</span> <span class="mi">0101</span> <span class="ow">and</span> <span class="mi">0001</span> <span class="p">,</span><span class="n">result</span> <span class="n">would</span> <span class="n">be</span> <span class="mi">0001</span>
<span class="p">;</span><span class="n">Few</span> <span class="n">more</span> <span class="n">examples</span><span class="p">:</span> <span class="mi">1111</span> <span class="o">&amp;</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">,</span><span class="mi">1111</span> <span class="o">&amp;</span> <span class="mi">1101</span> <span class="o">==</span> <span class="mi">1101</span>
<span class="ow">and</span> <span class="n">eax</span><span class="p">,</span><span class="n">a</span>

<span class="p">;</span> <span class="n">OR</span>
<span class="p">;</span> <span class="n">Similar</span> <span class="n">to</span> <span class="ow">and</span> <span class="p">,</span> <span class="n">it</span> <span class="n">performs</span> <span class="n">bitwise</span> <span class="n">OR</span>
<span class="p">;</span> <span class="mi">1100</span> <span class="o">|</span> <span class="mi">0000</span> <span class="o">==</span> <span class="mi">1100</span><span class="p">,</span><span class="mi">1010</span> <span class="o">|</span> <span class="mi">0101</span> <span class="o">==</span> <span class="mi">1111</span>
<span class="ow">or</span> <span class="n">eax</span><span class="p">,</span><span class="n">a</span>

<span class="p">;</span> <span class="n">XOR</span>
<span class="p">;</span> <span class="k">if</span> <span class="mi">2</span> <span class="n">bits</span> <span class="n">are</span> <span class="n">diferend</span> <span class="n">resulting</span> <span class="n">bit</span> <span class="ow">is</span> <span class="mi">1</span>
<span class="p">;</span> <span class="mi">1010</span> <span class="n">xor</span> <span class="mi">1001</span> <span class="o">==</span> <span class="mi">0011</span><span class="p">,</span> <span class="mi">1111</span> <span class="n">xor</span> <span class="mi">1101</span> <span class="o">==</span> <span class="mi">1101</span>
<span class="n">xor</span> <span class="n">eax</span><span class="p">,</span><span class="n">a</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Bit
shifting</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">;</span> <span class="n">LEFT</span> <span class="p">(</span><span class="n">sal</span><span class="p">,</span><span class="n">shl</span> <span class="o">-</span><span class="n">google</span> <span class="n">diferences</span><span class="p">)</span>
<span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="mi">5</span>   <span class="p">;</span><span class="n">eax</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">(</span><span class="n">eax</span> <span class="o">=</span> <span class="mi">0101</span><span class="o">***</span><span class="p">)</span>
<span class="p">;</span> <span class="o">***</span><span class="n">Of</span> <span class="n">course</span> <span class="k">if</span> <span class="n">it</span> <span class="n">was</span> <span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span> <span class="n">bit</span> <span class="n">it</span> <span class="n">would</span> <span class="n">have</span> <span class="n">more</span> <span class="mi">0</span>
<span class="n">shl</span> <span class="n">eax</span><span class="p">,</span><span class="mh">0x8</span> <span class="p">;</span><span class="n">eax</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="p">,</span> <span class="n">shift</span> <span class="n">eax</span> <span class="mi">8</span> <span class="n">bits</span> <span class="n">to</span> <span class="n">left</span>

<span class="p">;</span> <span class="n">RIGHT</span> <span class="p">(</span><span class="n">sar</span><span class="p">,</span><span class="n">shl</span> <span class="o">-</span><span class="n">google</span> <span class="n">diferences</span><span class="p">)</span>
<span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="mi">5</span>
<span class="n">shr</span> <span class="n">eax</span><span class="p">,</span><span class="mh">0x8</span> <span class="p">;</span><span class="n">eax</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">shift</span> <span class="n">eax</span> <span class="mi">8</span> <span class="n">bits</span> <span class="n">to</span> <span class="n">right</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>stack</td>
</tr>
</tbody>
</table>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">push</span> <span class="o">-&gt;</span> <span class="n">add</span> <span class="n">new</span> <span class="n">element</span> <span class="n">on</span> <span class="n">top</span> <span class="n">of</span> <span class="n">the</span> <span class="n">stack</span>
<span class="o">&gt;</span> <span class="n">pop</span> <span class="o">-&gt;</span> <span class="n">remove</span> <span class="n">the</span> <span class="n">top</span><span class="o">-</span><span class="n">most</span> <span class="n">element</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">stack</span>

<span class="n">x86</span> <span class="n">uses</span> <span class="s1">&#39;esp&#39;</span> <span class="n">register</span> <span class="n">to</span> <span class="n">point</span> <span class="n">to</span> <span class="n">the</span> <span class="n">top</span> <span class="n">of</span> <span class="n">the</span> <span class="n">stack</span><span class="p">(</span><span class="n">the</span> <span class="n">newest</span> <span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gnu-debugger">
<h3>GNU Debugger<a class="headerlink" href="#gnu-debugger" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>make some test C file(simple hello world)</dt>
<dd><code class="docutils literal"><span class="pre">gdb</span> <span class="pre">hello.c</span></code>
(gdb) info target,
Entry point - First code the program runs,
example: &#8220;Entry point: 0x580&#8221;</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>same like &#8220;info target&#8221; but with more info</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">maint</span> <span class="pre">info</span> <span class="pre">sections</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>you can also display only few sections</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">maint</span> <span class="pre">info</span> <span class="pre">sections</span> <span class="pre">.text</span> <span class="pre">.data</span> <span class="pre">.bss</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>displat only sections that contain &#8220;CODE&#8221;</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">maint</span> <span class="pre">info</span> <span class="pre">sections</span> <span class="pre">CODE</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>list all function names and their loaded addresses you can use regex to filter also</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">info</span> <span class="pre">functions</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>list all global and static variable names you can use regex also</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">info</span> <span class="pre">variables</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List current values in commonly used registers</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">info</span> <span class="pre">registers</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>display assembly code of a function</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">disassemble</span> <span class="pre">main</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>display assembly code with source code</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">disassemble</span> <span class="pre">/s</span> <span class="pre">main</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>display assembly code with souece code and hex</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">disassemble</span> <span class="pre">/rs</span> <span class="pre">main</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>display function in a specific file</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">disassemble</span> <span class="pre">/rs</span> <span class="pre">'hello.c'::main</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>start running the program</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">r</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>instead of running from start to finish run until line 3</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">b</span> <span class="pre">3</span></code></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Proceed to the next statement,first line is output produced after executing that line, 2nd line shows where gdb stops currently</dt>
<dd>(gdb) <code class="docutils literal"><span class="pre">n</span></code></dd>
</dl>
</li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/logo.gif" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">KaTOS</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#development-environment">Development environment</a><ul>
<li><a class="reference internal" href="#preparing-the-box">Preparing the box</a></li>
<li><a class="reference internal" href="#cross-compiler">Cross Compiler</a></li>
<li><a class="reference internal" href="#first-steps">First steps</a></li>
<li><a class="reference internal" href="#building-iso">Building ISO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basics">Basics</a><ul>
<li><a class="reference internal" href="#bootloader">Bootloader</a></li>
<li><a class="reference internal" href="#foobar">FooBar</a></li>
<li><a class="reference internal" href="#spam">Spam</a></li>
<li><a class="reference internal" href="#spaz">Spaz</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notes">Notes</a><ul>
<li><a class="reference internal" href="#text">Text</a></li>
<li><a class="reference internal" href="#x86-assembly">x86 Assembly</a></li>
<li><a class="reference internal" href="#gnu-debugger">GNU Debugger</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="notes.html" title="next chapter">Notes</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, frainfreeze, kegl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>